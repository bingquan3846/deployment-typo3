function PowermailBackend(e){"use strict";var t=this;this.initialize=function(){t.addDetailOpenListener(),t.addVisibilityChangeListener(),t.addDeleteMailListener(),t.addPageBrowseParamsListener(),t.addSortingParamsListener(),t.addSelectLineListener(),t.addSelectAllLinesListener(),t.addDeleteLinesListener(),t.addToggleLinesVisibilityListener(),t.addExtendedSearchListener(),t.addDatePickerListener(),t.addExportListener(),t.addConverterDetailsOpenListener(),t.hidePasswords(),t.reportingView()},this.addDetailOpenListener=function(){e(".powermail_listbe_details_container").hide(),e(".openPowermailDetails").click(function(){var i=e(this),t=i.closest("tr").children(":first").children(":first");t.hasClass("fa")?t.toggleClass("fa-caret-right").toggleClass("fa-caret-down"):t.toggleClass("t3-icon-irre-collapsed").toggleClass("t3-icon-irre-expanded"),i.closest("tr").next().toggleClass("powermail_listbe_details_closed").find(".powermail_listbe_details_container").slideToggle()})},this.addVisibilityChangeListener=function(){e(document).on("click",".unhideMail, .hideMail",function(){var i=e(this),s=i.closest("td").find(".container_module_uri").val(),a=i.closest("td").find(".container_uid").val(),n=i.closest("td").find(".container_table").val(),l=t.visibilityToggleLine(i.closest("tr"));t.sendVisibilityRequest(n,a,l,s)})},this.addDeleteMailListener=function(){e(document).on("click",".deleteMail",function(){var i=e(this),s=i.closest("td").find(".container_module_uri").val(),a=i.closest("td").find(".container_uid").val(),n=i.closest("td").find(".container_table").val(),l=i.closest("td").find(".container_label_delete_confirmation").val();confirm(l)&&(t.removeLine(i.closest("tr")),t.sendDeleteRequest(n,a,s))})},this.addPageBrowseParamsListener=function(){e(".f3-widget-paginator a").click(function(t){var s=e(this).prop("href"),a=s.split("&");for(i=0;i<a.length;i++)if(-1!==a[i].indexOf("widget"))var n=a[i];if(void 0!=n){var l=n.split("=");l[0]=l[0].replace("%40","@");var o='<input type="hidden" name="'+l[0]+'" value="'+l[1]+'" />';e(".hiddenvalues").append(decodeURI(o)),e("#powermail_module_search").submit()}t.preventDefault()})},this.addSortingParamsListener=function(){e("a.sorting").click(function(t){t.preventDefault();var s=e(this).prop("href"),a=s.split("&");for(i=0;i<a.length;i++)if(-1!==a[i].indexOf("sorting"))var n=a[i];if(void 0!=n){var l=n.split("=");l[0]=l[0].replace("%40","@");var o=e('.extended_export_sorting_container[name="'+decodeURI(l[0])+'"]');o.length&&o.remove();var d='<input type="hidden" name="'+l[0]+'" value="'+l[1]+'" />';e(".hiddenvalues").append(decodeURI(d)),e("#powermail_module_search").submit()}})},this.addSelectLineListener=function(){e(".addPowermailSelection").click(function(){t.selectOrDeselectLine(e(this)),t.calculateAndWriteNumbersOfSelections()})},this.addSelectAllLinesListener=function(){e(".addPowermailSelectionAll").click(function(){e(".addPowermailSelection").each(function(){t.selectOrDeselectLine(e(this))}),t.calculateAndWriteNumbersOfSelections()})},this.addDeleteLinesListener=function(){e(".powermailSelectionDelete").click(function(){t.deleteSelectedLines()})},this.addToggleLinesVisibilityListener=function(){e(".powermailSelectionHide").click(function(){t.toggleVisibilityOfLines(e)})},this.addExtendedSearchListener=function(){e(".extended_search_title").click(function(){var i=e(this);i.hasClass("powermail-close")?(i.removeClass("powermail-close").addClass("powermail-open").children("span").removeClass("t3-icon-move-down").addClass("t3-icon-move-up"),e("fieldset.extended_search").slideDown("",function(){e(this).children(".powermail_module_search_field_container1").children("div.powermail_module_search_field").fadeTo("slow",1)})):(i.removeClass("powermail-open").addClass("powermail-close").children("span").removeClass("t3-icon-move-up").addClass("t3-icon-move-down"),e("fieldset.extended_search").children(".powermail_module_search_field_container1").children("div.powermail_module_search_field").fadeTo("slow",0,function(){e(this).parent().parent().slideUp()}))}),e("fieldset.extended_search input, fieldset.extended_search select").each(function(){return""!=e(this).val()?(e(".extended_search_title").removeClass("powermail-close").addClass("powermail-open"),void e(".extended_search").removeClass("powermail-close").addClass("powermail-open")):void 0}),e(".powermail_module_search_field_container2 input, .powermail_module_search_field_container2 select").each(function(){return""!=e(this).val()?void e(this).parent().parent().removeClass("powermail-close").addClass("powermail-open"):void 0}),e(".searchAddField span, .searchAddField label").click(function(){e("fieldset.extended_search .powermail-close").slideToggle()})},this.addDatePickerListener=function(){e(".powermail_date").each(function(){var i=e(this),t=!0,s=!0;"date"===i.data("datepicker-settings")?s=!1:"time"===i.data("datepicker-settings")&&(t=!1),i.datetimepicker({format:i.data("datepicker-format"),timepicker:s,datepicker:t,lang:"en",i18n:{en:{months:i.data("datepicker-months").split(","),dayOfWeek:i.data("datepicker-days").split(",")}}})})},this.addExportListener=function(){e(".export_icon_xls, .export_icon_csv").click(function(){e(this).hasClass("export_icon_csv")&&e("#forwardToAction").val("exportCsv"),e(this).hasClass("export_icon_xls")&&e("#forwardToAction").val("exportXls"),e(this).closest("form").submit()}),e(".extended_export_title").click(function(){var i=e(this);i.hasClass("powermail-close")?(i.removeClass("powermail-close").addClass("powermail-open").children("span").removeClass("t3-icon-move-down").addClass("t3-icon-move-up"),i.next().slideDown("",function(){i.next().children("div").children("div").fadeTo("slow",1)})):(i.removeClass("powermail-open").addClass("powermail-close").children("span").removeClass("t3-icon-move-up").addClass("t3-icon-move-down"),i.next().children("div").children("div").fadeTo("slow",0,function(){i.next().slideUp()}))}),e(function(){e(".extended_export_field, .extended_export_field_container").sortable({connectWith:".connected",update:function(i,t){var s=e(this).prop("id");if("export_field_selection"===s){var a=e(this).sortable("toArray").toString();e("#export_fields").val(a)}}}).disableSelection()})},this.addConverterDetailsOpenListener=function(){e(".openHiddenTable").click(function(){var i=e(this).closest("tr");i.find(".dots").toggle(),i.find(".hiddenConverterTable").toggle()})},this.hidePasswords=function(){e(".powermail_listbe_details_dd.powermail_listbe_details_type_password").html("********")},this.reportingView=function(){var i=e(".powermail_reporting_form_fields_table");i.find("tr:even").addClass("even"),i.find("tr:first").removeClass("even"),i.find("tr").hide(),i.find("tr:first").show(),i.find("th").click(function(){var i=e(this);i.hasClass("powermail-close")?i.removeClass("powermail-close").addClass("powermail-open"):i.removeClass("powermail-open").addClass("powermail-close"),i.parent().siblings().slideToggle("fast")}),e('*[data-flot-active="1"]').each(function(){for(var i=e(this),s=[],a=t.split(i.data("flot-data-values"),","),n=t.split(i.data("flot-data-labels"),","),l=t.split(i.data("flot-data-colors"),","),o=0;o<a.length;o++){var d={data:a[o],label:n[o],color:l[o]};s.push(d)}e.plot(i,s,{series:{pie:{show:!0,innerRadius:.5,radius:1,opacity:.3,color:"#FF0000",label:{show:!0,radius:1,formatter:t.labelFormatter,background:{opacity:.8}},combine:{color:"#999",threshold:.1}}},grid:{hoverable:!0,clickable:!0}}),i.bind("plothover",function(i,t,s){if(s){var a=parseFloat(s.series.percent).toFixed(2);e("#hover").html("<span style='font-weight:bold; color:"+s.series.color+"'>"+s.series.label+" ("+a+"%)</span>")}}),i.bind("plotclick",function(e,i,t){if(t){var s=parseFloat(t.series.percent).toFixed(2);alert(""+t.series.label+": "+s+"%")}})})},this.visibilityToggleLine=function(e){var i=e.find(".visibilityButton"),t=1;return i.hasClass("unhideMail")?(i.removeClass("t3-icon-edit-hide").removeClass("unhideMail").removeClass("fa-toggle-on").addClass("t3-icon-edit-unhide").addClass("hideMail").addClass("fa-toggle-off"),e.find(".t3-icon-tcarecords-tx_powermail_domain_model_mails").addClass("transparent")):(i.removeClass("t3-icon-edit-unhide").removeClass("hideMail").removeClass("fa-toggle-off").addClass("t3-icon-edit-hide").addClass("unhideMail").addClass("fa-toggle-on"),e.find(".t3-icon-tcarecords-tx_powermail_domain_model_mails").removeClass("transparent"),t=0),t},this.sendVisibilityRequest=function(i,t,s,a){var n=a+"&data["+i+"]["+t+"][hidden]="+s+"&redirect="+T3_THIS_LOCATION;e.ajax({url:n})},this.sendDeleteRequest=function(i,t,s){var a=s+"&cmd["+i+"]["+t+"][delete]=1&redirect="+T3_THIS_LOCATION;e.ajax({url:a})},this.removeLine=function(e){e.fadeOut("slow",function(){e.next().remove(),e.remove()})},this.selectOrDeselectLine=function(e){e.hasClass("fa")?e.toggleClass("fa-plus").toggleClass("fa-minus").closest("tr").toggleClass("selectLine"):e.toggleClass("t3-icon-view-table-expand").toggleClass("t3-icon-view-table-collapse").closest("tr").toggleClass("selectLine")},this.calculateAndWriteNumbersOfSelections=function(){var i=e(".selectLine").length;e(".selectedLineMessage_numbers").html(i),i>0?e(".selectedLineMessage").show():e(".selectedLineMessage").hide()},this.deleteSelectedLines=function(){e(".selectLine").each(function(){var i=e(this),s=i.children(":last"),a=s.find(".container_module_uri").val(),n=s.find(".container_uid").val(),l=s.find(".container_table").val();t.sendDeleteRequest(l,n,a),t.removeLine(i),t.deselectLine(i)}),t.calculateAndWriteNumbersOfSelections()},this.deselectLine=function(e){var i=e.find(".addPowermailSelection");t.selectOrDeselectLine(i)},this.toggleVisibilityOfLines=function(){e(".selectLine").each(function(){var i=e(this),s=i.children(":last"),a=s.find(".container_module_uri").val(),n=s.find(".container_uid").val(),l=s.find(".container_table").val();t.sendVisibilityRequest(l,n,t.visibilityToggleLine(i),a),t.deselectLine(i)}),t.calculateAndWriteNumbersOfSelections()},this.split=function(e,i){if(-1!==e.toString().indexOf(i))var t=e.split(i);else t=[e];return t},this.labelFormatter=function(e,i){return'<div class="flotLabel">'+e+"<br/>"+Math.round(i.percent)+"%</div>"},window.PowermailBackend=PowermailBackend}jQuery(document).ready(function(e){var i=new window.PowermailBackend(e);i.initialize()});