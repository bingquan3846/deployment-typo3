function PowermailForm(e){"use strict";var t=this;this.initialize=function(){t.addTabsListener(),t.addAjaxFormSubmitListener(),t.getLocationAndWrite(),t.addDatePicker(),t.hidePasswords(),t.addResetListener(),t.deleteAllFilesListener(),t.uploadValidationListener()},this.addTabsListener=function(){e.fn.powermailTabs&&e(".powermail_morestep").each(function(){e(this).powermailTabs()})},this.addAjaxFormSubmitListener=function(){e("form[data-powermail-ajax]").length&&t.ajaxFormSubmit()},this.getLocationAndWrite=function(){e(".powermail_fieldwrap_location input").length&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(i){var a=i.coords.latitude,r=i.coords.longitude,o=t.getBaseUrl()+"/index.php?eID=powermailEidGetLocation";jQuery.ajax({url:o,data:"lat="+a+"&lng="+r,cache:!1,beforeSend:function(){e("body").css("cursor","wait")},complete:function(){e("body").css("cursor","default")},success:function(t){t&&e(".powermail_fieldwrap_location input").val(t)}})})},this.addDatePicker=function(){e.fn.datetimepicker&&e(".powermail_date").each(function(){var i=e(this);if("date"===i.prop("type")||"datetime-local"===i.prop("type")||"time"===i.prop("type")){if(!i.data("datepicker-force")){if(e(this).data("date-value")){var a=t.getDatetimeForDateFields(e(this).data("date-value"),e(this).data("datepicker-format"),i.prop("type"));null!==a&&e(this).val(a)}return}i.prop("type","text")}var r=!0,o=!0;"date"===i.data("datepicker-settings")?o=!1:"time"===i.data("datepicker-settings")&&(r=!1),i.datetimepicker({format:i.data("datepicker-format"),timepicker:o,datepicker:r,lang:"en",i18n:{en:{months:i.data("datepicker-months").split(","),dayOfWeek:i.data("datepicker-days").split(",")}}})})},this.hidePasswords=function(){e(".powermail_all_type_password.powermail_all_value").html("********")},this.addResetListener=function(){e.fn.parsley&&e(".powermail_reset").on("click","",function(){e('form[data-parsley-validate="data-parsley-validate"]').parsley().reset()})},this.uploadValidationListener=function(){window.ParsleyValidator&&(t.uploadSizeValidatorListener(),t.uploadExtensionValidatorListener())},this.ajaxFormSubmit=function(){var i,a=!1;e(document).on("submit","form[data-powermail-ajax]",function(r){var o=e(this);o.data("powermail-ajax-uri")&&(i=o.data("powermail-ajax-uri"));var n=o.data("powermail-form");a||(e.ajax({type:"POST",url:o.prop("action"),data:new FormData(o.get(0)),contentType:!1,processData:!1,beforeSend:function(){e(".powermail_submit",o).parent().append(t.getProgressbar()),e(".powermail_confirmation_submit, .powermail_confirmation_form",o).closest(".powermail_confirmation").append(t.getProgressbar())},complete:function(){e(".powermail_fieldwrap_submit",o).find(".powermail_progressbar").remove(),t.deleteAllFilesListener()},success:function(r){var l=e('*[data-powermail-form="'+n+'"]:first',r);l.length?(e('*[data-powermail-form="'+n+'"]:first').closest(".tx-powermail").html(l),e.fn.powermailTabs&&e(".powermail_morestep").powermailTabs(),e.fn.parsley&&e('form[data-parsley-validate="data-parsley-validate"]').parsley(),t.reloadCaptchaImages()):(i?window.location=i:o.submit(),a=!0)}}),r.preventDefault())})},this.deleteAllFilesListener=function(){e(".powermail_fieldwrap_file_inner").find(".deleteAllFiles").each(function(){t.disableUploadField(e(this).closest(".powermail_fieldwrap_file_inner").find('input[type="file"]'))}),e(".deleteAllFiles").click(function(){t.enableUploadField(e(this).closest(".powermail_fieldwrap_file_inner").children('input[type="hidden"]')),e(this).closest("ul").fadeOut(function(){e(this).remove()})})},this.disableUploadField=function(e){e.prop("disabled","disabled").addClass("hide").prop("type","hidden")},this.enableUploadField=function(e){e.prop("disabled",!1).removeClass("hide").prop("type","file")},this.reloadCaptchaImages=function(){e("img.powermail_captchaimage").each(function(){var i=t.getUriWithoutGetParam(e(this).prop("src"));e(this).prop("src",i+"?hash="+t.getRandomString(5))})},this.getUriWithoutGetParam=function(e){var t=e.split("?");return t[0]},this.getRandomString=function(e){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;e>a;a++)t+=i.charAt(Math.floor(Math.random()*i.length));return t},this.getDatetimeForDateFields=function(e,t,i){var a=Date.parseDate(e,t);if(null===a)return null;var r=new Date(a),o=r.getFullYear()+"-";o+=("0"+(r.getMonth()+1)).slice(-2)+"-",o+=("0"+r.getDate()).slice(-2);var n=("0"+r.getHours()).slice(-2)+":"+("0"+r.getMinutes()).slice(-2),l=o+"T"+n;return"date"===i?o:"datetime-local"===i?l:"time"===i?n:null},this.getProgressbar=function(){return e("<div />").addClass("powermail_progressbar").html(e("<div />").addClass("powermail_progress").html(e("<div />").addClass("powermail_progess_inner")))},this.getMaxFileSize=function(e){for(var t=e.get(0),i=0,a=0;a<t.files.length;a++){var r=t.files[a];r.size>i&&(i=r.size)}return parseInt(i)},this.uploadSizeValidatorListener=function(){window.ParsleyValidator.addValidator("powermailfilesize",function(i,a){if(-1!==a.indexOf(",")){var r=a.split(","),o=parseInt(r[0]),n=e('*[name="tx_powermail_pi1[field]['+r[1]+'][]"]');if(n.length&&t.getMaxFileSize(n)>o)return!1}return!0},32).addMessage("en","powermailfilesize","Error")},this.uploadExtensionValidatorListener=function(){window.ParsleyValidator.addValidator("powermailfileextensions",function(i,a){var r=e('*[name="tx_powermail_pi1[field]['+a+'][]"]');return r.length?t.isFileExtensionInList(t.getExtensionFromFileName(i),r.prop("accept")):!0},32).addMessage("en","powermailfileextensions","Error")},this.isFileExtensionInList=function(e,t){return-1!==t.indexOf("."+e)},this.getExtensionFromFileName=function(e){return e.split(".").pop()},this.getBaseUrl=function(){var t;return t=e("base").length>0?jQuery("base").prop("href"):"https:"!=window.location.protocol?"http://"+window.location.hostname:"https://"+window.location.hostname}}jQuery(document).ready(function(e){"use strict";var t=new window.PowermailForm(e);t.initialize()});